# MultiScreenKey 架构文档

## 1. 项目概述
MultiScreenKey 是一个基于 Android 的远程控制应用，支持 NFC 标签识别和自定义控制界面。核心功能包括设备扫描、远程控制、NFC 标签匹配和自定义界面布局。

## 2. 架构设计

### 2.1 整体架构
项目采用分层架构设计，分为以下模块：
- **UI 层**：基于 Jetpack Compose 实现，负责用户交互和界面展示。
- **业务逻辑层**：处理核心功能逻辑，如设备扫描、NFC 识别和远程控制。
- **数据层**：管理配置持久化和网络通信。

### 2.2 模块划分

#### 2.2.1 UI 模块
- **MainActivity**：主界面，负责设备扫描和 NFC 功能。
- **ControlActivity**：控制界面入口，展示自定义控制面板。
- **CustomControlScreen**：实现按钮拖拽和缩放功能。
- **HostSettingsActivity**：主机配置界面。

#### 2.2.2 业务逻辑模块
- **HostScanner**：网络扫描器，支持 CIDR 格式的地址扫描。
- **WsClient**：WebSocket 客户端，负责与远程主机通信。
- **ButtonLayoutManager**：管理按钮布局的保存和加载。

#### 2.2.3 数据模块
- **ConfigManager**：配置管理，包括 CIDR、端口和按钮布局。
- **UUIDManager**：设备 ID 管理。

## 3. 技术栈
- **UI 框架**：Jetpack Compose + Material Design 3
- **网络通信**：WebSocket + OkHttp
- **数据持久化**：SharedPreferences + JSON 文件
- **NFC 功能**：Android NFC API

## 4. 核心流程

### 4.1 设备扫描流程
1. 用户输入 CIDR 地址和端口。
2. HostScanner 启动多线程扫描。
3. 扫描结果通过 UI 展示。

### 4.2 NFC 控制流程
1. 用户将 NFC 标签贴近设备。
2. 系统读取标签 ID 并匹配配置的主机。
3. 跳转到对应主机的控制界面。

### 4.3 自定义界面流程
1. 用户进入控制界面并点击编辑按钮。
2. 拖拽按钮调整位置，缩放调整大小。
3. 保存布局配置到本地文件。

## 5. 数据流
- **配置数据**：通过 ConfigManager 从本地文件加载和保存。
- **控制命令**：通过 WsClient 发送到远程主机。

## 6. 扩展性设计
- **模块化**：各功能模块解耦，便于扩展新功能。
- **配置灵活**：支持自定义 CIDR、端口和按钮布局。

## 7. 性能优化
- **多线程扫描**：HostScanner 使用并发线程提高扫描效率。
- **轻量级通信**：WebSocket 实现低延迟控制。

## 8. 安全考虑
- **NFC 标签验证**：仅匹配已配置的主机标签 ID。
- **网络通信加密**：支持 WebSocket over TLS（可选）。

## 9. 后续改进
- **多语言支持**：国际化适配。
- **云端同步**：支持配置云端备份和同步。

---

*文档生成时间：2025-10-17*